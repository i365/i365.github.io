[{},{"attrs":{"title":"nginx proxy","description":"How to use nginx as a reverse proxy"},"body":"<h1><a id=\"using-nginx-as-a-reverse-proxy\" class=\"anchor\" aria-hidden=\"true\" href=\"#using-nginx-as-a-reverse-proxy\"><svg version=\"1.1\" width=\"16\" height=\"16\" viewBox=\"0 0 16 16\" class=\"octicon octicon-link\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"/></svg></a>Using nginx as a reverse proxy</h1><pre><code class=\"hljs nginx\">map $sent_http_content_type $expires {\n    \"text/html\"                 epoch;\n    \"text/html; charset=utf-8\"  epoch;\n    default                     off;\n}\n\nserver {\n    listen          80;             # the port nginx is listening on\n    server_name     your-domain;    # setup your domain here\n\n    gzip            on;\n    gzip_types      text/plain application/xml text/css application/javascript;\n    gzip_min_length 1000;\n\n    location / {\n        expires $expires;\n\n        proxy_redirect                      off;\n        proxy_set_header Host               $host;\n        proxy_set_header X-Real-IP          $remote_addr;\n        proxy_set_header X-Forwarded-For    $proxy_add_x_forwarded_for;\n        proxy_set_header X-Forwarded-Proto  $scheme;\n        proxy_read_timeout          1m;\n        proxy_connect_timeout       1m;\n        proxy_pass                          http://127.0.0.1:3000; # set the adress of the Node.js instance here\n    }\n}</code></pre><h1><a id=\"using-nginx-with-generated-pages-and-a-caching-proxy-as-fallback\" class=\"anchor\" aria-hidden=\"true\" href=\"#using-nginx-with-generated-pages-and-a-caching-proxy-as-fallback\"><svg version=\"1.1\" width=\"16\" height=\"16\" viewBox=\"0 0 16 16\" class=\"octicon octicon-link\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"/></svg></a>Using nginx with generated pages and a caching proxy as fallback</h1><p>If you have a high volume website with regularly changing content, you might want to benefit from Nuxt generate capabilities and <a href=\"https://www.nginx.com/blog/nginx-caching-guide\">nginx caching</a>.</p>\n<p>Below is an example configuration. Keep in mind that:</p>\n<ul>\n<li>root folder should be the same as set by <a href=\"/api/configuration-generate#dir\">configuration generate.dir</a></li>\n<li>expire headers set by Nuxt are stripped (due to the cache)</li>\n<li>both Nuxt as nginx can set additional headers, it&#39;s advised to choose one (if in doubt, choose nginx)</li>\n<li>if your site is mostly static, increase the <code>proxy_cache_path inactive</code> and <code>proxy_cache_valid</code> numbers</li>\n</ul>\n<p>If you don&#39;t generate your routes but still wish to benefit from nginx cache:</p>\n<ul>\n<li>remove the <code>root</code> entry</li>\n<li>change <code>location @proxy {</code> to <code>location / {</code></li>\n<li>remove the other 2 <code>location</code> entries</li>\n</ul>\n<pre><code class=\"hljs nginx\">proxy_cache_path  /data/nginx/cache levels=1:2 keys_zone=nuxt-cache:25m max_size=1g inactive=60m use_temp_path=off;\n\nmap $sent_http_content_type $expires {\n    \"text/html\"                 1h; # set this to your needs\n    \"text/html; charset=utf-8\"  1h; # set this to your needs\n    default                     7d; # set this to your needs\n}\n\nserver {\n    listen          80;             # the port nginx is listening on\n    server_name     your-domain;    # setup your domain here\n\n    gzip            on;\n    gzip_types      text/plain application/xml text/css application/javascript;\n    gzip_min_length 1000;\n\n    charset utf-8;\n\n    root /var/www/NUXT_PROJECT_PATH/dist\n\n    location ~* \\.(?:ico|gif|jpe?g|png|woff2?|eot|otf|ttf|svg|js|css)$ {\n        expires $expires;\n        add_header Pragma public;\n        add_header Cache-Control \"public\";\n\n        try_files $uri $uri/ @proxy;\n    }\n\n    location / {\n        expires $expires;\n        add_header Content-Security-Policy \"default-src 'self' 'unsafe-inline';\";\n        add_header Strict-Transport-Security \"max-age=31536000; includeSubDomains; preload\" always;\n        add_header X-Frame-Options \"SAMEORIGIN\";\n\n        try_files $uri $uri/index.html @proxy; # for generate.subFolders: true\n        # try_files $uri $uri.html @proxy; # for generate.subFolders: false\n    }\n\n    location @proxy {\n        expires $expires;\n        add_header Content-Security-Policy \"default-src 'self' 'unsafe-inline';\";\n        add_header Strict-Transport-Security \"max-age=31536000; includeSubDomains; preload\" always;\n        add_header X-Frame-Options \"SAMEORIGIN\";\n        add_header X-Cache-Status $upstream_cache_status;\n\n        proxy_redirect                      off;\n        proxy_set_header Host               $host;\n        proxy_set_header X-Real-IP          $remote_addr;\n        proxy_set_header X-Forwarded-For    $proxy_add_x_forwarded_for;\n        proxy_set_header X-Forwarded-Proto  $scheme;\n        proxy_ignore_headers        Cache-Control;\n        proxy_http_version          1.1;\n        proxy_read_timeout          1m;\n        proxy_connect_timeout       1m;\n        proxy_pass                  http://127.0.0.1:3000; # set the adress of the Node.js instance here\n        proxy_cache                 nuxt-cache;\n        proxy_cache_bypass          $arg_nocache; # probably better to change this\n        proxy_cache_valid           200 302  60m; # set this to your needs\n        proxy_cache_valid           404      1m;  # set this to your needs\n        proxy_cache_lock            on;\n        proxy_cache_use_stale error timeout http_500 http_502 http_503 http_504;\n        proxy_cache_key             $uri$is_args$args;\n        proxy_cache_purge           PURGE from 127.0.0.1;\n    }\n}</code></pre><h1><a id=\"nginx-configuration-for-laravel-forge\" class=\"anchor\" aria-hidden=\"true\" href=\"#nginx-configuration-for-laravel-forge\"><svg version=\"1.1\" width=\"16\" height=\"16\" viewBox=\"0 0 16 16\" class=\"octicon octicon-link\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"/></svg></a>nginx configuration for Laravel Forge</h1><p>Change <code>YOUR_WEBSITE_FOLDER</code> to your website folder and <code>YOUR_WEBSITE_DOMAIN</code> to your website URL. Laravel Forge will have filled out these values for you but be sure to double check.</p>\n<pre><code class=\"hljs nginx\"># FORGE CONFIG (DOT NOT REMOVE!)\ninclude forge-conf/YOUR_WEBSITE_FOLDER/before/*;\n\nmap $sent_http_content_type $expires {\n    \"text/html\"                 epoch;\n    \"text/html; charset=utf-8\"  epoch;\n    default                     off;\n}\n\nserver {\n    listen 80;\n    listen [::]:80;\n    server_name YOUR_WEBSITE_DOMAIN;\n\n    add_header X-Frame-Options \"SAMEORIGIN\";\n    add_header X-XSS-Protection \"1; mode=block\";\n    add_header X-Content-Type-Options \"nosniff\";\n\n    charset utf-8;\n\n    gzip            on;\n    gzip_types      text/plain application/xml text/css application/javascript;\n    gzip_min_length 1000;\n\n    # FORGE CONFIG (DOT NOT REMOVE!)\n    include forge-conf/YOUR_WEBSITE_FOLDER/server/*;\n\n    location / {\n        expires $expires;\n\n        proxy_redirect off;\n        proxy_set_header Host               $host;\n        proxy_set_header X-Real-IP          $remote_addr;\n        proxy_set_header X-Forwarded-For    $proxy_add_x_forwarded_for;\n        proxy_set_header X-Forwarded-Proto  $scheme;\n        proxy_read_timeout          1m;\n        proxy_connect_timeout       1m;\n        proxy_pass                          http://127.0.0.1:3000; # set the adress of the Node.js\n    }\n\n    access_log off;\n    error_log  /var/log/nginx/YOUR_WEBSITE_FOLDER-error.log error;\n\n    location ~ /\\.(?!well-known).* {\n        deny all;\n    }\n}\n\n# FORGE CONFIG (DOT NOT REMOVE!)\ninclude forge-conf/YOUR_WEBSITE_FOLDER/after/*;</code></pre><h1><a id=\"secure-laravel-forge-with-tls\" class=\"anchor\" aria-hidden=\"true\" href=\"#secure-laravel-forge-with-tls\"><svg version=\"1.1\" width=\"16\" height=\"16\" viewBox=\"0 0 16 16\" class=\"octicon octicon-link\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"/></svg></a>Secure Laravel Forge with TLS</h1><p>It&#39;s best to let Laravel Forge do the editing of the <code>nginx.conf</code> for you, by clicking on Sites -&gt; YOUR_WEBSITE_DOMAIN (SERVER_NAME) and then click on SSL and install a certificate from one of the providers. Remember to activate the certificate. Your <code>nginx.conf</code> should now look something like this:</p>\n<pre><code class=\"hljs nginx\"># FORGE CONFIG (DOT NOT REMOVE!)\ninclude forge-conf/YOUR_WEBSITE_FOLDER/before/*;\n\nmap $sent_http_content_type $expires {\n    \"text/html\"                 epoch;\n    \"text/html; charset=utf-8\"  epoch;\n    default                     off;\n}\n\nserver {\n    listen 443 ssl http2;\n    listen [::]:443 ssl http2;\n    server_name YOUR_WEBSITE_DOMAIN;\n\n    # FORGE SSL (DO NOT REMOVE!)\n    ssl_certificate /etc/nginx/ssl/YOUR_WEBSITE_FOLDER/258880/server.crt;\n    ssl_certificate_key /etc/nginx/ssl/YOUR_WEBSITE_FOLDER/258880/server.key;\n\n    ssl_protocols TLSv1 TLSv1.1 TLSv1.2;\n    ssl_ciphers 'ECDHE-RSA-AES128-GCM-SHA256:ECDHE-ECDSA-AES128-GCM-SHA256:ECDHE-RSA-AES256-GCM-SHA384:ECDHE-ECDSA-AES256-GCM-SHA384:DHE-RSA-AES128-GCM-SHA256:DHE-DSS-AES128-GCM-SHA256:kEDH+AESGCM:ECDHE-RSA-AES128-SHA256:ECDHE-ECDSA-AES128-SHA256:ECDHE-RSA-AES128-SHA:ECDHE-ECDSA-AES128-SHA:ECDHE-RSA-AES256-SHA384:ECDHE-ECDSA-AES256-SHA384:ECDHE-RSA-AES256-SHA:ECDHE-ECDSA-AES256-SHA:DHE-RSA-AES128-SHA256:DHE-RSA-AES128-SHA:DHE-DSS-AES128-SHA256:DHE-RSA-AES256-SHA256:DHE-DSS-AES256-SHA:DHE-RSA-AES256-SHA:AES128-GCM-SHA256:AES256-GCM-SHA384:AES128-SHA256:AES256-SHA256:AES128-SHA:AES256-SHA:AES:CAMELLIA:DES-CBC3-SHA:!aNULL:!eNULL:!EXPORT:!DES:!RC4:!MD5:!PSK:!aECDH:!EDH-DSS-DES-CBC3-SHA:!EDH-RSA-DES-CBC3-SHA:!KRB5-DES-CBC3-SHA:!3DES';\n    ssl_prefer_server_ciphers on;\n    ssl_dhparam /etc/nginx/dhparams.pem;\n\n    add_header X-Frame-Options \"SAMEORIGIN\";\n    add_header X-XSS-Protection \"1; mode=block\";\n    add_header X-Content-Type-Options \"nosniff\";\n\n    charset utf-8;\n\n    gzip            on;\n    gzip_types      text/plain application/xml text/css application/javascript;\n    gzip_min_length 1000;\n\n    # FORGE CONFIG (DOT NOT REMOVE!)\n    include forge-conf/YOUR_WEBSITE_FOLDER/server/*;\n\n    location / {\n        expires $expires;\n\n        proxy_set_header Host               $host;\n        proxy_set_header X-Real-IP          $remote_addr;\n        proxy_set_header X-Forwarded-For    $proxy_add_x_forwarded_for;\n        proxy_set_header X-Forwarded-Proto  $scheme;\n        proxy_redirect              off;\n        proxy_read_timeout          1m;\n        proxy_connect_timeout       1m;\n        proxy_pass                          http://127.0.0.1:3000; # set the adress of the Node.js\n    }\n\n    access_log off;\n    error_log  /var/log/nginx/YOUR_WEBSITE_FOLDER-error.log error;\n\n    location ~ /\\.(?!well-known).* {\n        deny all;\n    }\n}\n\n# FORGE CONFIG (DOT NOT REMOVE!)\ninclude forge-conf/YOUR_WEBSITE_FOLDER/after/*;</code></pre>","docLink":"https://github.com/nuxt/docs/blob/master/en/faq/nginx-proxy.md"}]